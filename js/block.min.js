/*! mediatheque - v1.4.0-alpha - 2021-09-05 2:16:43 PM UTC - https://imathi.eu/tag/mediatheque */

!function(s,o){var r=o.element.createElement,e=o.blocks.registerBlockType,l=o.editor.InspectorControls,d=o.editor.BlockControls,c=o.editor.AlignmentToolbar,u=o.components.Toolbar,m=o.components.PanelBody,b=r("svg",{key:"mediatheque-icon","aria-hidden":!0,role:"img",className:"dashicon mediatheque-icon",focusable:"false",width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{key:"camera",d:"M 13 11 L 13 4 C 13 3.45 12.55 3 12 3 L 10.33 3 L 9 1 L 5 1 L 3.67 3 L 2 3 C 1.45 3 1 3.45 1 4 L 1 11 C 1 11.55 1.45 12 2 12 L 12 12 C 12.55 12 13 11.55 13 11 Z"}),r("path",{key:"sound",d:"M 14 6 L 19 6 L 19 16.5 C 19 17.88 17.88 19 16.5 19 C 15.12 19 14 17.88 14 16.5 C 14 15.12 15.12 14 16.5 14 C 16.67 14 16.84 14.02 17 14.05 L 17 9 L 14 9 L 14 6 Z"}),r("path",{key:"user-head",d:"M 7 4.5 C 8.38 4.5 9.5 5.62 9.5 7 C 9.5 8.38 8.38 9.5 7 9.5 C 5.62 9.5 4.5 8.38 4.5 7 C 4.5 5.62 5.62 4.5 7 4.5 Z",style:{fill:"rgb(255, 255, 255)"}}),r("path",{key:"user-body",d:"M 7.006 11.465 L 9.121 10.05 C 10.979 10.05 12.636 11.861 12.636 13.573 L 12.636 15.508 C 12.636 15.508 9.797 16.386 7.006 16.386 C 4.168 16.386 1.376 15.508 1.376 15.508 L 1.376 13.573 C 1.376 11.823 2.885 10.089 4.852 10.089 Z",style:{stroke:"rgb(255, 255, 255)"}})]);e("mediatheque/usermedia",{title:"MediaThèque",description:mediaThequeBlock.description,icon:function(){return b},category:"common",attributes:{link:{type:"string"},title:{type:"string"},alignment:{type:"string"}},edit:function(a){function i(e){s("#"+a.clientId).parent().find(".notice-error").remove(),s("#"+a.clientId).parent().removeClass("components-placeholder"),s("#"+a.clientId).before(e).remove()}var e,t=a.attributes.alignment,n=a.isSelected;return a&&a.attributes.link?a.attributes.title?[!!n&&r(l,{key:"controls"},[r(m,{key:"label",title:mediaThequeBlock.alignmentLabel},r(c,{key:"aligncontrol",value:t,onChange:function(e){a.setAttributes({alignment:e})}}))]),r("p",{key:"editable",className:"mediatheque-private",focus:n.toString(),style:{textAlign:t},onFocus:a.setFocus},r("a",{href:a.attributes.link},a.attributes.title))]:(a.attributes.userMediaFetched?"error"!==a.attributes.userMediaFetched&&window.setTimeout(function(){i(a.attributes.userMediaFetched)},500):(e=a.attributes.link,o.ajax.post("parse-embed",{post_ID:o.media.view.settings.post.id,type:"embed",shortcode:"[embed]"+e+"[/embed]"}).done(function(e){var t=!0;e.body?(t="A"===s(e.body).prop("tagName")?s(e.body).html():e.body,i(t)):a.setAttributes({link:!(t="error")}),a.setAttributes({userMediaFetched:t})}).fail(function(){a.setAttributes({userMediaFetched:"error"}),a.setAttributes({link:!1})})),r("div",{className:"components-placeholder"},[r("div",{id:a.clientId,key:"loading",className:"wp-block-embed is-loading"},r("span",{className:"spinner is-active"})),!!n&&r(d,{key:"controls"},r(u,{controls:[{icon:"edit",title:mediaThequeBlock.editTitle,onClick:function(){var i=o.media.embed.edit(a.attributes.link,!0);i.state("embed").props.on("change:url",function(e,t){t&&e.get("url")&&(i.state("embed").metadata=e.toJSON())}),i.state("embed").on("select",function(){var e=i.state("embed").metadata,t=s(".editor-block-list__block.is-selected .editor-block-list__block-edit [data-block]");e&&e.url!==a.attributes.link&&(t.addClass("components-placeholder").html(s("<div></div>").addClass("wp-block-embed is-loading").html(s("<span></span>").addClass("spinner is-active")).prop("id",a.clientId)),a.setAttributes({link:e.url,userMediaFetched:!1}))}),i.on("close",function(){i.detach()}),i.open()}}]}))])):r("div",{className:"components-placeholder"},[r("div",{key:"block-placeholder",className:"components-placeholder__label"},[b,r("label",{key:"block-label"},"MediaThèque")]),r("button",{key:"user-media-select-button",type:"button",id:a.clientId,className:"mediatheque-block button button-large",onClick:function(e){e.preventDefault();var i=s(e.currentTarget),e={frame:"post",state:"user-media",title:o.media.view.l10n.addMedia,isUserMediaOnly:!0,gutenbergBlock:!0};mediaThequeSettings.common.isUserMediaOnly=!0,mediaThequeSettings.params=_.omit(mediaThequeSettings.params,"dropzone"),o.media.editor.open(".gutenberg",e),s(".media-frame-uploader").css({display:"none"}),o.media.frame.on("select",function(){var e,t;i.data("link")&&!a.attributes.link&&(e=i.data("link"),(t=i.data("title"))?a.setAttributes({title:t,link:e,userMediaFetched:!0}):a.setAttributes({link:e,userMediaFetched:!1}))})}},mediaThequeBlock.insertBtn),"error"===a.attributes.userMediaFetched&&r("div",{className:"notice notice-alt notice-error",key:"user-media-error"},r("p",{className:null},mediaThequeBlock.genericError))])},save:function(e){if(e&&e.attributes.link&&"false"!==e.attributes.link)return e.attributes.title?r("p",{className:"mediatheque-private",style:{textAlign:e.attributes.alignment}},r("a",{href:e.attributes.link},e.attributes.title)):r("p",{},e.attributes.link)}})}(jQuery,window.wp||{});