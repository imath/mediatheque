/*! mediatheque - v1.1.0-alpha - 2017-11-27 7:54:15 PM UTC - https://imathi.eu/tag/mediatheque */
!function(a,b){var c=b.element.createElement,d=b.blocks.registerBlockType,e=b.blocks.InspectorControls,f=b.blocks.BlockControls,g=b.blocks.AlignmentToolbar,h=b.components.Toolbar;d("mediatheque/usermedia",{title:"MediaTh√®que",icon:c("svg",{"aria-hidden":!0,role:"img",className:"dashicons mediatheque-icon",focusable:"false",width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[c("path",{key:"camera",d:"M 13 11 L 13 4 C 13 3.45 12.55 3 12 3 L 10.33 3 L 9 1 L 5 1 L 3.67 3 L 2 3 C 1.45 3 1 3.45 1 4 L 1 11 C 1 11.55 1.45 12 2 12 L 12 12 C 12.55 12 13 11.55 13 11 Z"}),c("path",{key:"sound",d:"M 14 6 L 19 6 L 19 16.5 C 19 17.88 17.88 19 16.5 19 C 15.12 19 14 17.88 14 16.5 C 14 15.12 15.12 14 16.5 14 C 16.67 14 16.84 14.02 17 14.05 L 17 9 L 14 9 L 14 6 Z"}),c("path",{key:"user-head",d:"M 7 4.5 C 8.38 4.5 9.5 5.62 9.5 7 C 9.5 8.38 8.38 9.5 7 9.5 C 5.62 9.5 4.5 8.38 4.5 7 C 4.5 5.62 5.62 4.5 7 4.5 Z",style:{fill:"rgb(255, 255, 255)"}}),c("path",{key:"user-body",d:"M 7.006 11.465 L 9.121 10.05 C 10.979 10.05 12.636 11.861 12.636 13.573 L 12.636 15.508 C 12.636 15.508 9.797 16.386 7.006 16.386 C 4.168 16.386 1.376 15.508 1.376 15.508 L 1.376 13.573 C 1.376 11.823 2.885 10.089 4.852 10.089 Z",style:{stroke:"rgb(255, 255, 255)"}})]),category:"common",attributes:{link:{type:"string"},title:{type:"string"},alignment:{type:"string"}},edit:function(d){var i=d.attributes.alignment,j=d.focus,k=function(b){a("#"+d.id).parent().find(".notice-error").remove(),a("#"+d.id).parent().removeClass("components-placeholder"),a("#"+d.id).before(b).remove()},l=function(c){b.ajax.post("parse-embed",{post_ID:b.media.view.settings.post.id,type:"embed",shortcode:"[embed]"+c+"[/embed]"}).done(function(b){var c=!0;b.body?(c="A"===a(b.body).prop("tagName")?a(b.body).html():b.body,k(c)):(c="error",d.setAttributes({link:!1})),d.setAttributes({userMediaFetched:c})}).fail(function(){d.setAttributes({userMediaFetched:"error"}),d.setAttributes({link:!1})})},m=function(c){c.preventDefault();var e=a(c.currentTarget),f={frame:"post",state:"user-media",title:b.media.view.l10n.addMedia,isUserMediaOnly:!0,gutenbergBlock:!0};mediaThequeSettings.common.isUserMediaOnly=!0,mediaThequeSettings.params=_.omit(mediaThequeSettings.params,"dropzone"),b.media.editor.open(".gutenberg",f),a(".media-frame-uploader").css({display:"none"}),b.media.frame.on("select",function(){if(e.data("link")&&!d.attributes.link){var a=e.data("link"),b=e.data("title");b?d.setAttributes({title:b,link:a,userMediaFetched:!0}):d.setAttributes({link:a,userMediaFetched:!1})}})},n=function(a){d.setAttributes({alignment:a})},o=function(){var c=b.media.embed.edit(d.attributes.link,!0);c.state("embed").props.on("change:url",function(a,b){b&&a.get("url")&&(c.state("embed").metadata=a.toJSON())}),c.state("embed").on("select",function(){var b=c.state("embed").metadata,e=a(".editor-visual-editor__block.is-selected .editor-visual-editor__block-edit div");b&&b.url!==d.attributes.link&&(e.addClass("components-placeholder").html(a("<div></div>").addClass("wp-block-embed is-loading").html(a("<span></span>").addClass("spinner is-active")).prop("id",d.id)),d.setAttributes({link:b.url,userMediaFetched:!1}))}),c.on("close",function(){c.detach()}),c.open()};return d&&d.attributes.link?d.attributes.title?[!!j&&c(e,{key:"controls"},[c("h3",{key:"label"},mediaThequeBlock.alignmentLabel),c(g,{key:"aligncontrol",value:i,onChange:n})]),c("p",{key:"editable",className:"mediatheque-private",focus:j,style:{textAlign:i},onFocus:d.setFocus},c("a",{href:d.attributes.link},d.attributes.title))]:(d.attributes.userMediaFetched?"error"!==d.attributes.userMediaFetched&&window.setTimeout(function(){k(d.attributes.userMediaFetched)},500):l(d.attributes.link),c("div",{className:"components-placeholder"},[c("div",{id:d.id,key:"loading",className:"wp-block-embed is-loading"},c("span",{className:"spinner is-active"})),!!j&&c(f,{key:"controls"},c(h,{controls:[{icon:"edit",title:mediaThequeBlock.editTitle,onClick:o}]}))])):c("div",{className:"components-placeholder"},[c("button",{key:"user-media-select-button",type:"button",id:d.id,className:"mediatheque-block button button-large",onClick:m},mediaThequeBlock.insertBtn),"error"===d.attributes.userMediaFetched&&c("div",{className:"notice notice-alt notice-error",key:"user-media-error"},c("p",{className:null},mediaThequeBlock.genericError))])},save:function(a){if(a&&a.attributes.link&&"false"!==a.attributes.link)return a.attributes.title?c("p",{className:"mediatheque-private",style:{textAlign:a.attributes.alignment}},c("a",{href:a.attributes.link},a.attributes.title)):"<p>"+a.attributes.link+"</p>"}})}(jQuery,window.wp||{});