/*! mediatheque - v1.2.0 - 2018-06-14 4:13:19 PM UTC - https://imathi.eu/tag/mediatheque */
window.wp=window.wp||{},window.mediaTheque=window.mediaTheque||_.extend({},_.pick(window.wp,"Backbone","template")),function(a){mediaTheque.Models=mediaTheque.Models||{},mediaTheque.Collections=mediaTheque.Collections||{},mediaTheque.Views=mediaTheque.Views||{},mediaTheque.View=mediaTheque.Backbone.View.extend({prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}}}),mediaTheque.Views.User=mediaTheque.View.extend({tagName:"li",className:"user",template:mediaTheque.template("mediatheque-user")}),mediaTheque.Views.Feedback=mediaTheque.Views.User.extend({className:"notice",template:mediaTheque.template("mediatheque-feedback"),events:{"click .notice-dismiss":"removeSelf"},initialize:function(){_.extend(this.model.attributes,_.pick(mediaThequeSettings.common,"dismissibleText")),this.model.get("type")&&(this.el.className+=" "+this.model.get("type")),this.model.get("dismissible")&&(this.el.className+=" is-dismissible")},removeSelf:function(){this.remove()}}),mediaTheque.Views.Users=mediaTheque.View.extend({tagName:"ul",className:"users",events:{"click a.user-link":"displayUserMedia"},initialize:function(){this.collection.on("add",this.prepareNewView,this),this.isRequestingMore=!1,this.scrollingElement=a(document),a(".media-frame-content").length?this.scrollingElement=a(".media-frame-content"):this.options.scrollingElement&&(this.scrollingElement=a(this.options.scrollingElement)),this.scrollingElement.on("scroll",_.bind(this.scroll,this))},prepareNewView:function(a){var b=this.options||{};b.ghost.add(a),this.addItemView(a)},addItemView:function(a){this.views.add(new mediaTheque.Views.User({model:a}))},displayUserMedia:function(b){b.preventDefault();var c=a(b.currentTarget).data("id");_.each(this.collection.models,function(a){var b={current:!1};c===a.get("id")&&(b.current=!0),a.set(b)})},getScrollData:function(){return{}},scroll:function(){var b=this.$el.offset(),c=document.body,d=a(document).scrollTop(),e=20;if(a("#wpadminbar").length&&(e+=a("#wpadminbar").height()),this.$el.is(":visible")&&this.collection.hasMore()&&!this.isRequestingMore&&!this.$el.hasClass("loading")&&d+c.clientHeight+e>this.el.clientHeight+b.top){var f=this.getScrollData();this.isRequestingMore=!0,this.collection.more({data:f,success:_.bind(this.resetRequestingMore,this),error:_.bind(this.resetRequestingMore,this)})}},resetRequestingMore:function(){this.isRequestingMore=!1}}),mediaTheque.Views.Droppable=mediaTheque.View.extend({initialize:function(){this.$el.attr("data-id",this.model.get("id")),this.$el.bind("dragover",_.bind(this.dragOver,this)),this.$el.bind("dragenter",_.bind(this.dragOver,this)),this.$el.bind("dragleave",_.bind(this.dragLeave,this)),this.$el.bind("drop",_.bind(this.dropIn,this)),this.isDroppable=!0},dragOver:function(a){var b=a;return b.preventDefault(),b.originalEvent&&(b=b.originalEvent),!(-1===_.indexOf(b.dataTransfer.types,"modelid")||!this.isDroppable)&&(this.$el.hasClass("drag-over")||this.$el.addClass("drag-over"),!1)},dragLeave:function(a){return a.preventDefault(),!!this.isDroppable&&(this.$el.hasClass("drag-over")&&this.$el.removeClass("drag-over"),!1)},dropIn:function(a){var b=a;return b.originalEvent&&(b=b.originalEvent),!!this.isDroppable&&(this.$el.hasClass("drag-over")&&this.$el.removeClass("drag-over"),void this.handleDrop(b.dataTransfer.getData("modelId")))},handleDrop:function(b){if(!_.isUndefined(b)){var c=this.options.ghost.get(b),d=this.model.get("id");_.isNaN(d)&&(d=0),a("#trail ul").first().addClass("loading"),a("#media ul").first().addClass("loading"),Backbone.emulateHTTP=!0,c.save({post_parent:this.model.get("id")},{success:_.bind(this.userMediaMoved,this)})}},userMediaMoved:function(b){a("#trail ul").first().removeClass("loading"),a("#media ul").first().removeClass("loading"),this.options.ghost.remove(b)}}),mediaTheque.Views.editUserMedia=mediaTheque.View.extend({className:"media-edit",events:{"click button.reset":"removeView","click button.submit":"updateUserMedia"},initialize:function(){this.userMedia=new wp.api.models.UserMedia({id:this.model.get("id")}),this.userMedia.fetch({data:{user_media_edit:!0},success:_.bind(this.setEditFields,this)})},setEditFields:function(a){var b=mediaThequeSettings.editFields;_.each(b,function(b,c){var d=a.get(c);d&&(_.isUndefined(d.rendered)?b.value=d:b.value=d.rendered,b.id=c),this.views.add(new mediaTheque.Views.Field({model:new Backbone.Model(b)},{at:b.position}))},this)},removeView:function(b){b.preventDefault(),a(b.currentTarget).closest("li.user-media").removeClass("editing"),a("#mediatheque-backdrop").removeClass("editing"),this.remove()},updateUserMedia:function(b){b.preventDefault();var c=a(b.currentTarget).closest("form").find("[data-setting]"),d={};_.each(c,function(b){var c,e=a(b).data("setting"),f=this.model.get(e);c="DIV"===a(b).prop("tagName")?a(b).html():a(b).val(),f&&(_.isUndefined(f.rendered)||(f=f.rendered),f!==c&&(d[e]=c))},this),_.isEmpty(d)||(this.userMedia.save(_.extend(d,{post_parent:this.userMedia.get("parent")||0})),this.model.set({edited:d})),this.removeView(b)}}),mediaTheque.Views.UserMedia=mediaTheque.Views.Droppable.extend({tagName:"li",className:"user-media",template:mediaTheque.template("mediatheque-media"),events:{"click .delete":"deleteUserMedia","click .edit":"editUserMedia"},initialize:function(){var a=this.options||{};this.model.get("uploading")?(this.model.on("change:percent",this.progress,this),this.model.on("change:guid",this.update,this),this.model.on("destroy",this.remove,this)):"dir"===this.model.get("media_type")?(this.el.className+=" dir droppable","wp-editor"!==a.uiType&&"display"!==a.uiType?mediaTheque.Views.Droppable.prototype.initialize.apply(this,arguments):this.$el.attr("data-id",this.model.get("id")),this.model.set({uiType:a.uiType},{silent:!0})):this.setMediaProps(),this.model.on("change:edited",this.update,this)},setMediaProps:function(){var a=this.options||{};if("wp-editor"!==a.uiType&&"display"!==a.uiType?this.$el.prop("draggable",!0):this.el.className+=" selectable",this.$el.attr("data-id",this.model.get("id")),"image"===this.model.get("media_type")&&this.model.get("guid")){var b,c=this.model.get("guid").rendered,d=c,e=this.model.get("media_details");_.isObject(e.sizes)&&e.sizes.medium&&(b=e.file.split("/"),c=c.replace(b[b.length-1],e.sizes.medium.file)),this.model.set({background:c,fullUrl:d},{silent:!0})}this.model.set({download:this.model.get("link")+mediaThequeSettings.common.downloadSlug+"/",uiType:a.uiType},{silent:!0}),!0===this.model.previous("uploading")&&_.extend(this.model,{urlRoot:mediaTheque.App.overrides.url})},progress:function(b){_.isUndefined(b.get("percent"))||a("#"+b.get("id")+" .mediatheque-progress .mediatheque-bar").css("width",b.get("percent")+"%")},update:function(a,b){_.isUndefined(a.filename)?!_.isUndefined(b.title)&&b.title&&b.title!==this.model.get("title").rendered&&this.model.set({title:{rendered:b.title},edited:{}},{silent:!0}):_.each(["date","filename","uploading","subtype"],function(b){a.unset(b,{silent:!0})}),this.setMediaProps(),this.render()},deleteUserMedia:function(b){b.preventDefault(),Backbone.emulateHTTP=!0,a("#trail ul").first().addClass("loading"),a("#media ul").first().addClass("loading"),this.model.destroy({wait:!0,success:_.bind(this.userMediaDeleted,this)})},userMediaDeleted:function(b){a("#trail ul").first().removeClass("loading"),a("#media ul").first().removeClass("loading"),this.options.ghost.remove(b)},editUserMedia:function(b){b.preventDefault(),this.views.set(".user-media-edit-container",new mediaTheque.Views.editUserMedia({model:this.model})),this.$el.addClass("editing"),a("#mediatheque-backdrop").addClass("editing")}}),mediaTheque.Views.UserMedias=mediaTheque.Views.Users.extend({tagName:"ul",className:"user-media",events:{"click .dir .user-media-content":"openDir","click .selectable":"selectMedia","dragstart [draggable=true]":"setDragData"},initialize:function(){var a=this.options||{};mediaTheque.Views.Users.prototype.initialize.apply(this,arguments),this.queryUserMedia(),this.listenTo(a.queryVars,"change:parent",this.getChildren),this.listenTo(a.ghost,"remove",this.adjustMore),this.listenTo(a.ghost,"change:selected",this.setSelection)},adjustMore:function(a){var b=a.get("id");this.excludeDisplayed=[],!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&b&&_.each(this.views._views[""],function(a){b===a.model.get("id")?a.remove():this.excludeDisplayed.push(a.model.get("id"))},this),this.collection.get(b)&&this.collection.remove(b),this.collection.state.totalObjects-=1,this.views._views[""].length>=this.collection.state.totalObjects&&delete this.excludeDisplayed},getScrollData:function(){var a={};return _.isArray(this.excludeDisplayed)&&(_.extend(a,{exclude:this.excludeDisplayed.join(","),page:1}),delete this.excludeDisplayed),a},queryUserMedia:function(a){var b=this.options||{};_.isObject(a)&&b.queryVars.set(a),!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&_.each(this.views._views[""],function(a){a.remove()}),"undefined"!=typeof mediaThequeCustoms&&mediaThequeCustoms.mediaType&&(0===b.queryVars.get("parent")&&b.queryVars.unset("parent",{silent:!0}),b.queryVars.set({media_type:mediaThequeCustoms.mediaType},{silent:!0})),this.collection.reset(),this.collection.fetch({data:b.queryVars.attributes,success:_.bind(this.doFeedback,this),error:_.bind(this.doFeedback,this)})},removeFeedback:function(){!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&_.each(this.views._views[""],function(a){a.$el.hasClass("notice")&&a.remove()})},doFeedback:function(a,b){var c=new Backbone.Model;if(!a.length){if(_.isUndefined(b.responseJSON))c.set({message:mediaThequeSettings.common.noUserMedia,type:"notice-warning"});else{if(_.isUndefined(b.responseJSON.message))return;c.set({message:b.responseJSON.message,type:"notice-error"})}this.views.add(new mediaTheque.Views.Feedback({model:c}),{at:0})}},addItemView:function(a){var b=this.options||{},c=a.get("at"),d=b.queryVars.get("user_media_context");this.removeFeedback(),_.isUndefined(c)?this.views.add(new mediaTheque.Views.UserMedia({model:a,ghost:b.ghost,uiType:d})):this.views.add(new mediaTheque.Views.UserMedia({model:a,ghost:b.ghost,uiType:d}),{at:c})},openDir:function(b){b.preventDefault();var c=a(b.currentTarget).closest(".dir").data("id"),d=this.options||{};c&&d.queryVars.set({parent:c})},selectMedia:function(b){var c=this.options;b.preventDefault();var d,e=b.currentTarget,f=a(e).data("id"),g=this;f&&(_.each(c.ghost.models,function(a){var b=!0;f!==a.get("id")?(a.set({selected:!1}),g.$el.find("li.user-media").removeClass("selected")):(b===a.get("selected")&&(b=!1),a.set({selected:b}))}),d=c.ghost.get(f),d.get("selected")?a(e).addClass("selected"):a(e).removeClass("selected"))},setSelection:function(a,b){var c=this.options.selection;return!(!0!==b&&!c.get(a))&&(c.length&&c.reset(),void(!0===b&&c.add(a)))},getChildren:function(a,b){_.isUndefined(b)||this.queryUserMedia()},setDragData:function(b){var c=b;return this.$el.closest("ul").hasClass("loading")?(b.preventDefault(),!1):(c.originalEvent&&(c=c.originalEvent),void c.dataTransfer.setData("modelId",a(b.currentTarget).data("id")))}}),mediaTheque.Views.displayUserMedias=mediaTheque.Views.UserMedias.extend({events:{"click .user-media-content":"selectMedia"},initialize:function(){var a={user_media_context:"display"};mediaTheque.Views.Users.prototype.initialize.apply(this,arguments),_.isUndefined(mediaThequeSettings.common.directory)||!1===mediaThequeSettings.common.directory||(a.parent=parseInt(mediaThequeSettings.common.directory,10)),!_.isUndefined(mediaThequeSettings.common.user_id)&&mediaThequeSettings.common.user_id&&(a.user_id=parseInt(mediaThequeSettings.common.user_id,10)),this.queryUserMedia(a)},selectMedia:function(b){var c=this.options;b.preventDefault();var d,e=a(b.currentTarget).closest("li"),f=a(e).data("id");f&&(d=c.ghost.get(f),d.get("link")&&(document.location.href=d.get("link")))}}),mediaTheque.Views.uploaderProgress=mediaTheque.View.extend({tagName:"div",className:"mediatheque-status",template:mediaTheque.template("mediatheque-progress"),initialize:function(){this.model.on("change:percent",this.progress,this)},progress:function(b){_.isUndefined(b.get("percent"))||a("#"+b.get("id")+" .mediatheque-progress .mediatheque-bar").css("width",b.get("percent")+"%")}}),mediaTheque.Views.MkDir=mediaTheque.View.extend({tagName:"div",id:"directory-form",className:"postbox",template:mediaTheque.template("mediatheque-dirmaker"),events:{"click button.close":"removeSelf","click #create-dir":"createDir"},initialize:function(){this.model.set(_.pick(mediaThequeSettings.common,"closeBtn"),{silent:!0}),this.on("ready",this.setFocus,this)},removeSelf:function(a){_.isObject(a)&&a.currentTarget&&a.preventDefault(),mediaTheque.App.toolbarItems.get(this.options.toolbarItem).set({active:!1})},createDir:function(b){b.preventDefault();var c=a(b.currentTarget).closest("form"),d={},e=this.options.params||{};if(_.each(a(c).serializeArray(),function(a){a.name=a.name.replace("[]",""),d[a.name]=a.value}),d.title){_.extend(d,e);var f=new wp.api.models.UserMedia(d);f.save({action:"mkdir_user_media"},{success:_.bind(this.mkdirSuccess,this),error:_.bind(this.mkdirError,this)})}},mkdirSuccess:function(a){a.set({at:0},{silent:!0}),mediaTheque.App.userMedia.add(a),this.removeSelf()},mkdirError:function(a,b){var c,d=this.options||{};_.isObject(d.mediaView)&&(b.responseJSON&&b.responseJSON.message&&(c=new Backbone.Model({dismissible:!0,type:"notice-error",message:b.responseJSON.message}),d.mediaView.views.add(new mediaTheque.Views.Feedback({model:c}),{at:0})),this.removeSelf())},setFocus:function(){this.$el.find("#dir-name").focus()}}),mediaTheque.Views.Uploader=mediaTheque.Views.MkDir.extend({id:mediaThequeSettings.params.container,className:"mediatheque-uploader-box",template:mediaTheque.template("mediatheque-uploader"),initialize:function(){this.model=new Backbone.Model(mediaThequeSettings.params),this.on("ready",this.initUploader),mediaTheque.Views.MkDir.prototype.initialize.apply(this,arguments)},initUploader:function(){var a=_.mapObject(_.pick(this.model.attributes,"container","browser","dropzone"),function(a){return"#"+a});_.extend(a,this.options||{}),this.uploader=new mediaTheque.Uploader(a),this.uploader.filesError.on("add",this.uploadError,this),this.uploader.filesQueue.on("add",this.addProgressView,this),this.uploader.filesQueue.on("reset",this.removeSelf,this)},uploadError:function(a){var b,c,d=this.options||{},e=new Backbone.Model({dismissible:!0,type:"notice-error"});b=a.get("file"),c=a.get("data"),a.get("feedback")?e.set({message:a.get("feedback")}):e.set({message:c.message}),_.isObject(d.mediaView)?(d.mediaView.collection.remove(b.id),d.mediaView.views.add(new mediaTheque.Views.Feedback({model:e}),{at:0})):this.views.add("#mediatheque-upload-status",new mediaTheque.Views.Feedback({model:e}))},addProgressView:function(a){var b=this.options||{};_.isObject(b.mediaView)?b.mediaView.collection.add(a.set({at:0},{silent:!0})):this.views.add("#mediatheque-upload-status",new mediaTheque.Views.uploaderProgress({model:a}))}}),mediaTheque.Views.ToolbarItem=mediaTheque.View.extend({tagName:"li",template:mediaTheque.template("mediatheque-toolbar-item"),initialize:function(){this.model.get("current")&&(this.el.className="current"),this.model.on("change:disable",this.refreshItem,this)},refreshItem:function(b,c){var d=a(this.$el).find("button").first();d.prop("disabled",c)}}),mediaTheque.Views.Toolbar=mediaTheque.View.extend({tagName:"ul",className:"filter-links",events:{"click button":"activateView"},initialize:function(){var a=this.options||{},b=0,c=!1;_.each(mediaThequeSettings.toolbarItems,function(d,e){b+=1,c=!(!a.users.length||"users"!==e),this.collection.add({id:e,name:d,position:b,current:c,disable:0!==a.users.length&&"users"!==e}),this.addItemBar(this.collection.get(e))},this),this.collection.on("change:current",this.refreshToolbar,this)},addItemBar:function(a){this.views.add(new mediaTheque.Views.ToolbarItem({model:a}))},refreshToolbar:function(b,c){!1!==c&&"false"!==c&&(_.each(this.$el.children(),function(b){a(b).removeClass("current")}),a(this.$el).find('[data-id="'+b.get("id")+'"]').parent("li").addClass("current"))},activateView:function(b){b.preventDefault();var c=a(b.currentTarget),d=!1,e=null;c.prop("disabled")||("upload"===c.data("id")||"directory"===c.data("id")?e=c.data("id"):"users"===c.data("id")&&(d=!0),_.each(this.collection.models,function(a){var b={disable:d,current:!1,active:!1};_.isNull(e)?a.get("id")===c.data("id")&&(b.current=!0,"users"===a.get("id")&&(b.disable=!1)):a.get("id")===e?b.active=!0:b.current=a.get("current"),a.set(b)},this))}}),mediaTheque.Views.trailItem=mediaTheque.Views.Droppable.extend({tagName:"li",template:mediaTheque.template("mediatheque-trail"),initialize:function(){mediaTheque.Views.Droppable.prototype.initialize.apply(this,arguments),this.isDroppable=!1,this.model.get("showLink")&&this.model.unset("showLink",{silent:!0}),this.model.on("change:showLink",this.rerender,this),this.model.on("remove",this.remove,this)},rerender:function(a,b){!0===b&&(this.isDroppable=!0),this.render()}}),mediaTheque.Views.Trail=mediaTheque.View.extend({tagName:"ul",className:"trail-links",events:{"click a":"moveUp"},initialize:function(){this.collection.on("reset",this.resetTrail,this),this.collection.on("add",this.addTrailItem,this)},resetTrail:function(){!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&_.each(this.views._views[""],function(a){a.remove()})},addTrailItem:function(a){this.views.add(new mediaTheque.Views.trailItem({model:a,ghost:this.options.ghost}))},moveUp:function(b){var c,d=this.options||{};b.preventDefault(),c=a(b.currentTarget).prop("class"),"root-dir"===c?d.queryVars.set({parent:0},{move:c}):"parent-dir"===c&&d.queryVars.set({parent:a(b.currentTarget).data("id")},{move:c})}}),mediaTheque.Views.Root=mediaTheque.View.extend({initialize:function(){var a=this.options||{};this.ghost=new Backbone.Collection,this.listenTo(a.toolbarItems,"change:active",this.displayForms),this.listenTo(a.toolbarItems,"change:current",this.manageLists),this.listenTo(a.queryVars,"change:parent",this.updateTrail),"wp-editor"===a.uiType?(a.users=[],this.setToolbar({models:a.users})):(this.views.set("#users",new mediaTheque.Views.Users({collection:a.users,ghost:this.ghost})),this.listenTo(a.users,"reset",this.queryUsers),a.users.on("change:current",this.setToolbar,this),a.users.reset())},queryUsers:function(){var a=this.options||{};a.users.fetch({data:{has_disk_usage:!0},success:_.bind(this.setToolbar,this)})},displayToolbar:function(){var a=this.options||{};_.isUndefined(this.views._views["#toolbar"])&&this.views.add("#toolbar",new mediaTheque.Views.Toolbar({collection:a.toolbarItems,users:a.users}))},setToolbar:function(a,b){var c,d,e=this.options||{};return!_.isUndefined(a.models)&&a.models.length?void this.displayToolbar():void((_.isUndefined(b)||!1!==b)&&(_.isUndefined(this.views._views["#toolbar"])?(delete mediaThequeSettings.toolbarItems.users,this.displayToolbar(),c=e.toolbarItems.findWhere({current:!0}),_.isUndefined(c)?_.first(e.toolbarItems.models).set({current:!0}):this.manageLists(c,!0),d=e.toolbarItems.findWhere({active:!0}),d&&e.toolbarItems.get(d).set({active:!1},{silent:!0})):_.each(e.toolbarItems.models,function(a,b){var c={disable:!1,current:!1};1===b&&(c.current=!0),a.set(c)})))},displayForms:function(a,b){var c=this.options||{},d={post_status:"publish"},e=null,f=_.isUndefined(this.views._views["#forms"])||0===this.views._views["#forms"].length;if(-1!==_.indexOf(["upload","directory"],a.get("id")))if(!1===b){if(f)return;_.each(this.views._views["#forms"],function(b){("upload"===a.get("id")&&b.uploader||"directory"===a.get("id")&&!b.uploader)&&b.remove()})}else f||_.each(this.views._views["#forms"],function(a){a.remove()}),e=c.toolbarItems.findWhere({current:!0}),_.isObject(e)&&(d.post_status=e.get("id")),c.queryVars.get("parent")&&(d.post_parent=c.queryVars.get("parent")),c.queryVars.get("user_id")&&(d.user_id=c.queryVars.get("user_id")),"upload"===a.get("id")?this.views.add("#forms",new mediaTheque.Views.Uploader({overrides:c.overrides,params:d,toolbarItem:"upload",mediaView:_.first(this.views._views["#media"])})):this.views.add("#forms",new mediaTheque.Views.MkDir({params:d,toolbarItem:"directory",model:new Backbone.Model(mediaThequeSettings.dirmaker),mediaView:_.first(this.views._views["#media"])}))},manageLists:function(a,b){var c=this.options||{};if("users"===a.get("id"))_.isUndefined(this.views._views["#media"])||0===this.views._views["#media"].length||_.first(this.views._views["#media"]).remove(),!1!==b||_.isUndefined(this.views._views["#users"])||0===this.views._views["#users"].length||_.first(this.views._views["#users"]).remove(),!0===b&&(this.views.set("#users",new mediaTheque.Views.Users({collection:c.users,ghost:this.ghost})),c.users.reset(),_.isUndefined(this.views._views["#trail"])||0===this.views._views["#trail"].length||_.first(this.views._views["#trail"]).remove());else if(!0===b){if((_.isUndefined(this.views._views["#trail"])||0===this.views._views["#trail"].length)&&this.views.add("#trail",new mediaTheque.Views.Trail({collection:c.trailItems,ghost:this.ghost,queryVars:c.queryVars})),c.trailItems.reset(),c.queryVars.clear(),c.queryVars.set({user_media_context:_.isUndefined(c.uiType)?"admin":c.uiType,post_status:a.get("id"),parent:0},{silent:!0}),c.users.length){var d=c.users.findWhere({current:!0});c.queryVars.set({user_id:d.get("id")},{silent:!0}),c.trailItems.add(d)}else c.queryVars.set({user_id:0},{silent:!0});c.trailItems.add(a),this.views.set("#media",new mediaTheque.Views.UserMedias({collection:c.media,ghost:this.ghost,queryVars:c.queryVars,selection:c.selection}))}},updateTrail:function(a,b,c){var d,e,f,g=this.options||{};if(!_.isUndefined(b))if(d=this.ghost.get(b),_.isUndefined(d)||c.move){if(c.move){"root-dir"===c.move?(f=g.toolbarItems.findWhere({current:!0}),e=g.trailItems.get(f.get("id")),e.set({showLink:!1})):(e=g.trailItems.get(b),e.set({showLink:!1}));var h=g.trailItems.where({media_type:"dir"});_.each(h,function(a){("root-dir"===c.move||a.get("id")>b)&&g.trailItems.remove(a)})}}else 0===d.get("parent")?(f=g.toolbarItems.findWhere({current:!0}),e=g.trailItems.get(f.get("id")),e.set({showLink:!0})):(e=g.trailItems.get(d.get("parent")),e.set({showLink:!0})),g.trailItems.add(this.ghost.get(b))}}),mediaTheque.Views.Display=mediaTheque.View.extend({initialize:function(){var a=this.options||{};this.ghost=new Backbone.Collection,this.views.set("#media",new mediaTheque.Views.displayUserMedias({collection:a.media,ghost:this.ghost,queryVars:a.queryVars,scrollingElement:"#mediatheque-container"}))}}),mediaTheque.Views.Field=mediaTheque.View.extend({tagName:"label",template:mediaTheque.template("mediatheque-field-item"),initialize:function(){var a=this.model.get("classes");-1!==_.indexOf(["submit","reset"],this.model.get("type"))?this.el.className=this.model.get("type"):_.isArray(a)&&(this.el.className=a.join(" "))}})}(jQuery);