/*! mediatheque - v1.4.0-alpha - 2021-09-05 2:16:43 PM UTC - https://imathi.eu/tag/mediatheque */

window.wp=window.wp||{},window.mediaTheque=window.mediaTheque||_.extend({},_.pick(window.wp,"Backbone","template")),function(d){mediaTheque.Models=mediaTheque.Models||{},mediaTheque.Collections=mediaTheque.Collections||{},mediaTheque.Views=mediaTheque.Views||{},mediaTheque.View=mediaTheque.Backbone.View.extend({prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}}}),mediaTheque.Views.User=mediaTheque.View.extend({tagName:"li",className:"user",template:mediaTheque.template("mediatheque-user")}),mediaTheque.Views.Feedback=mediaTheque.Views.User.extend({className:"notice",template:mediaTheque.template("mediatheque-feedback"),events:{"click .notice-dismiss":"removeSelf"},initialize:function(){_.extend(this.model.attributes,_.pick(mediaThequeSettings.common,"dismissibleText")),this.model.get("type")&&(this.el.className+=" "+this.model.get("type")),this.model.get("dismissible")&&(this.el.className+=" is-dismissible")},removeSelf:function(){this.remove()}}),mediaTheque.Views.Users=mediaTheque.View.extend({tagName:"ul",className:"users",events:{"click a.user-link":"displayUserMedia"},initialize:function(){this.collection.on("add",this.prepareNewView,this),this.isRequestingMore=!1,this.scrollingElement=d(document),d(".media-frame-content").length?this.scrollingElement=d(".media-frame-content"):this.options.scrollingElement&&(this.scrollingElement=d(this.options.scrollingElement)),this.scrollingElement.on("scroll",_.bind(this.scroll,this))},prepareNewView:function(e){(this.options||{}).ghost.add(e),this.addItemView(e)},addItemView:function(e){this.views.add(new mediaTheque.Views.User({model:e}))},displayUserMedia:function(e){e.preventDefault();var t=d(e.currentTarget).data("id");_.each(this.collection.models,function(e){var i={current:!1};t===e.get("id")&&(i.current=!0),e.set(i)})},getScrollData:function(){return{}},scroll:function(){var e=this.$el.offset(),i=document.body,t=d(document).scrollTop(),s=20;d("#wpadminbar").length&&(s+=d("#wpadminbar").height()),this.$el.is(":visible")&&this.collection.hasMore()&&!this.isRequestingMore&&!this.$el.hasClass("loading")&&t+i.clientHeight+s>this.el.clientHeight+e.top&&(e=this.getScrollData(),this.isRequestingMore=!0,this.collection.more({data:e,success:_.bind(this.resetRequestingMore,this),error:_.bind(this.resetRequestingMore,this)}))},resetRequestingMore:function(){this.isRequestingMore=!1}}),mediaTheque.Views.Droppable=mediaTheque.View.extend({initialize:function(){this.$el.attr("data-id",this.model.get("id")),this.$el.bind("dragover",_.bind(this.dragOver,this)),this.$el.bind("dragenter",_.bind(this.dragOver,this)),this.$el.bind("dragleave",_.bind(this.dragLeave,this)),this.$el.bind("drop",_.bind(this.dropIn,this)),this.isDroppable=!0},dragOver:function(e){return e.preventDefault(),e.originalEvent&&(e=e.originalEvent),-1!==_.indexOf(e.dataTransfer.types,"modelid")&&this.isDroppable&&(this.$el.hasClass("drag-over")||this.$el.addClass("drag-over")),!1},dragLeave:function(e){return e.preventDefault(),this.isDroppable&&this.$el.hasClass("drag-over")&&this.$el.removeClass("drag-over"),!1},dropIn:function(e){if(e.originalEvent&&(e=e.originalEvent),!this.isDroppable)return!1;this.$el.hasClass("drag-over")&&this.$el.removeClass("drag-over"),this.handleDrop(e.dataTransfer.getData("modelId"))},handleDrop:function(e){var i;_.isUndefined(e)||(i=this.options.ghost.get(e),e=this.model.get("id"),_.isNaN(e),d("#trail ul").first().addClass("loading"),d("#media ul").first().addClass("loading"),Backbone.emulateHTTP=!0,i.save({post_parent:this.model.get("id")},{success:_.bind(this.userMediaMoved,this)}))},userMediaMoved:function(e){d("#trail ul").first().removeClass("loading"),d("#media ul").first().removeClass("loading"),this.options.ghost.remove(e)}}),mediaTheque.Views.editUserMedia=mediaTheque.View.extend({className:"media-edit",events:{"click button.reset":"removeView","click button.submit":"updateUserMedia"},initialize:function(){this.userMedia=new wp.api.models.UserMedia({id:this.model.get("id")}),this.userMedia.fetch({data:{user_media_edit:!0},success:_.bind(this.setEditFields,this)})},setEditFields:function(s){var e=mediaThequeSettings.editFields;_.each(e,function(e,i){var t=s.get(i);t&&(_.isUndefined(t.rendered)?e.value=t:e.value=t.rendered,e.id=i),this.views.add(new mediaTheque.Views.Field({model:new Backbone.Model(e)},{at:e.position}))},this)},removeView:function(e){e.preventDefault(),d(e.currentTarget).closest("li.user-media").removeClass("editing"),d("#mediatheque-backdrop").removeClass("editing"),this.remove()},updateUserMedia:function(e){e.preventDefault();var i=d(e.currentTarget).closest("form").find("[data-setting]"),s={};_.each(i,function(e){var i=d(e).data("setting"),t=this.model.get(i),e="DIV"===d(e).prop("tagName")?d(e).html():d(e).val();t&&(t=!_.isUndefined(t.rendered)?t.rendered:t)!==e&&(s[i]=e)},this),_.isEmpty(s)||(this.userMedia.save(_.extend(s,{post_parent:this.userMedia.get("parent")||0})),this.model.set({edited:s})),this.removeView(e)}}),mediaTheque.Views.UserMedia=mediaTheque.Views.Droppable.extend({tagName:"li",className:"user-media",template:mediaTheque.template("mediatheque-media"),events:{"click .delete":"deleteUserMedia","click .edit":"editUserMedia"},initialize:function(){var e=this.options||{};this.model.get("uploading")?(this.model.on("change:percent",this.progress,this),this.model.on("change:guid",this.update,this),this.model.on("destroy",this.remove,this)):"dir"===this.model.get("media_type")?(this.el.className+=" dir droppable","wp-editor"!==e.uiType&&"display"!==e.uiType?mediaTheque.Views.Droppable.prototype.initialize.apply(this,arguments):this.$el.attr("data-id",this.model.get("id")),this.model.set({uiType:e.uiType},{silent:!0})):this.setMediaProps(),this.model.on("change:edited",this.update,this)},setMediaProps:function(){var e,i,t,s,a=this.options||{};"wp-editor"!==a.uiType&&"display"!==a.uiType?this.$el.prop("draggable",!0):this.el.className+=" selectable",this.$el.attr("data-id",this.model.get("id")),"image"===this.model.get("media_type")&&this.model.get("guid")&&(i=e=this.model.get("guid").rendered,t=this.model.get("media_details"),_.isObject(t.sizes)&&t.sizes.medium&&(s=t.file.split("/"),e=e.replace(s[s.length-1],t.sizes.medium.file)),this.model.set({background:e,fullUrl:i},{silent:!0})),this.model.set({download:this.model.get("link")+mediaThequeSettings.common.downloadSlug+"/",uiType:a.uiType},{silent:!0}),!0===this.model.previous("uploading")&&_.extend(this.model,{urlRoot:mediaTheque.App.overrides.url})},progress:function(e){_.isUndefined(e.get("percent"))||d("#"+e.get("id")+" .mediatheque-progress .mediatheque-bar").css("width",e.get("percent")+"%")},update:function(i,e){_.isUndefined(i.filename)?!_.isUndefined(e.title)&&e.title&&e.title!==this.model.get("title").rendered&&this.model.set({title:{rendered:e.title},edited:{}},{silent:!0}):_.each(["date","filename","uploading","subtype"],function(e){i.unset(e,{silent:!0})}),this.setMediaProps(),this.render()},deleteUserMedia:function(e){e.preventDefault(),Backbone.emulateHTTP=!0,d("#trail ul").first().addClass("loading"),d("#media ul").first().addClass("loading"),this.model.destroy({wait:!0,success:_.bind(this.userMediaDeleted,this)})},userMediaDeleted:function(e){d("#trail ul").first().removeClass("loading"),d("#media ul").first().removeClass("loading"),this.options.ghost.remove(e)},editUserMedia:function(e){e.preventDefault(),this.views.set(".user-media-edit-container",new mediaTheque.Views.editUserMedia({model:this.model})),this.$el.addClass("editing"),d("#mediatheque-backdrop").addClass("editing")}}),mediaTheque.Views.UserMedias=mediaTheque.Views.Users.extend({tagName:"ul",className:"user-media",events:{"click .dir .user-media-content":"openDir","click .selectable":"selectMedia","dragstart [draggable=true]":"setDragData"},initialize:function(){var e=this.options||{};mediaTheque.Views.Users.prototype.initialize.apply(this,arguments),this.queryUserMedia(),this.listenTo(e.queryVars,"change:parent",this.getChildren),this.listenTo(e.ghost,"remove",this.adjustMore),this.listenTo(e.ghost,"change:selected",this.setSelection)},adjustMore:function(e){var i=e.get("id");this.excludeDisplayed=[],!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&i&&_.each(this.views._views[""],function(e){i===e.model.get("id")?e.remove():this.excludeDisplayed.push(e.model.get("id"))},this),this.collection.get(i)&&this.collection.remove(i),--this.collection.state.totalObjects,this.views._views[""].length>=this.collection.state.totalObjects&&delete this.excludeDisplayed},getScrollData:function(){var e={};return _.isArray(this.excludeDisplayed)&&(_.extend(e,{exclude:this.excludeDisplayed.join(","),page:1}),delete this.excludeDisplayed),e},queryUserMedia:function(e){var i=this.options||{};_.isObject(e)&&i.queryVars.set(e),!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&_.each(this.views._views[""],function(e){e.remove()}),"undefined"!=typeof mediaThequeCustoms&&mediaThequeCustoms.mediaType&&(0===i.queryVars.get("parent")&&i.queryVars.unset("parent",{silent:!0}),i.queryVars.set({media_type:mediaThequeCustoms.mediaType},{silent:!0})),this.collection.reset(),this.collection.fetch({data:i.queryVars.attributes,success:_.bind(this.doFeedback,this),error:_.bind(this.doFeedback,this)})},removeFeedback:function(){!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&_.each(this.views._views[""],function(e){e.$el.hasClass("notice")&&e.remove()})},doFeedback:function(e,i){var t=new Backbone.Model;if(!e.length){if(_.isUndefined(i.responseJSON))t.set({message:mediaThequeSettings.common.noUserMedia,type:"notice-warning"});else{if(_.isUndefined(i.responseJSON.message))return;t.set({message:i.responseJSON.message,type:"notice-error"})}this.views.add(new mediaTheque.Views.Feedback({model:t}),{at:0})}},addItemView:function(e){var i=this.options||{},t=e.get("at"),s=i.queryVars.get("user_media_context");this.removeFeedback(),_.isUndefined(t)?this.views.add(new mediaTheque.Views.UserMedia({model:e,ghost:i.ghost,uiType:s})):this.views.add(new mediaTheque.Views.UserMedia({model:e,ghost:i.ghost,uiType:s}),{at:t})},openDir:function(e){e.preventDefault();var i=d(e.currentTarget).closest(".dir").data("id"),e=this.options||{};i&&e.queryVars.set({parent:i})},selectMedia:function(e){var i=this.options;e.preventDefault();var e=e.currentTarget,t=d(e).data("id"),s=this;t&&(_.each(i.ghost.models,function(e){var i=!0;t!==e.get("id")?(e.set({selected:!1}),s.$el.find("li.user-media").removeClass("selected")):(i===e.get("selected")&&(i=!1),e.set({selected:i}))}),i.ghost.get(t).get("selected")?d(e).addClass("selected"):d(e).removeClass("selected"))},setSelection:function(e,i){var t=this.options.selection;if(!0!==i&&!t.get(e))return!1;t.length&&t.reset(),!0===i&&t.add(e)},getChildren:function(e,i){_.isUndefined(i)||this.queryUserMedia()},setDragData:function(e){var i=e;if(this.$el.closest("ul").hasClass("loading"))return e.preventDefault(),!1;(i=i.originalEvent?i.originalEvent:i).dataTransfer.setData("modelId",d(e.currentTarget).data("id"))}}),mediaTheque.Views.displayUserMedias=mediaTheque.Views.UserMedias.extend({events:{"click .user-media-content":"selectMedia"},initialize:function(){var e={user_media_context:"display"};mediaTheque.Views.Users.prototype.initialize.apply(this,arguments),_.isUndefined(mediaThequeSettings.common.directory)||!1===mediaThequeSettings.common.directory||(e.parent=parseInt(mediaThequeSettings.common.directory,10)),!_.isUndefined(mediaThequeSettings.common.user_id)&&mediaThequeSettings.common.user_id&&(e.user_id=parseInt(mediaThequeSettings.common.user_id,10)),this.queryUserMedia(e)},selectMedia:function(e){var i=this.options;e.preventDefault();var t,e=d(e.currentTarget).closest("li"),e=d(e).data("id");e&&(t=i.ghost.get(e)).get("link")&&(document.location.href=t.get("link"))}}),mediaTheque.Views.uploaderProgress=mediaTheque.View.extend({tagName:"div",className:"mediatheque-status",template:mediaTheque.template("mediatheque-progress"),initialize:function(){this.model.on("change:percent",this.progress,this)},progress:function(e){_.isUndefined(e.get("percent"))||d("#"+e.get("id")+" .mediatheque-progress .mediatheque-bar").css("width",e.get("percent")+"%")}}),mediaTheque.Views.MkDir=mediaTheque.View.extend({tagName:"div",id:"directory-form",className:"postbox",template:mediaTheque.template("mediatheque-dirmaker"),events:{"click button.close":"removeSelf","click #create-dir":"createDir"},initialize:function(){this.model.set(_.pick(mediaThequeSettings.common,"closeBtn"),{silent:!0}),this.on("ready",this.setFocus,this)},removeSelf:function(e){_.isObject(e)&&e.currentTarget&&e.preventDefault(),mediaTheque.App.toolbarItems.get(this.options.toolbarItem).set({active:!1})},createDir:function(e){e.preventDefault();var i=d(e.currentTarget).closest("form"),t={},e=this.options.params||{};_.each(d(i).serializeArray(),function(e){e.name=e.name.replace("[]",""),t[e.name]=e.value}),t.title&&(_.extend(t,e),new wp.api.models.UserMedia(t).save({action:"mkdir_user_media"},{success:_.bind(this.mkdirSuccess,this),error:_.bind(this.mkdirError,this)}))},mkdirSuccess:function(e){e.set({at:0},{silent:!0}),mediaTheque.App.userMedia.add(e),this.removeSelf()},mkdirError:function(e,i){var t=this.options||{};_.isObject(t.mediaView)&&(i.responseJSON&&i.responseJSON.message&&(i=new Backbone.Model({dismissible:!0,type:"notice-error",message:i.responseJSON.message}),t.mediaView.views.add(new mediaTheque.Views.Feedback({model:i}),{at:0})),this.removeSelf())},setFocus:function(){this.$el.find("#dir-name").focus()}}),mediaTheque.Views.Uploader=mediaTheque.Views.MkDir.extend({id:mediaThequeSettings.params.container,className:"mediatheque-uploader-box",template:mediaTheque.template("mediatheque-uploader"),initialize:function(){this.model=new Backbone.Model(mediaThequeSettings.params),this.on("ready",this.initUploader),mediaTheque.Views.MkDir.prototype.initialize.apply(this,arguments)},initUploader:function(){var e=_.mapObject(_.pick(this.model.attributes,"container","browser","dropzone"),function(e){return"#"+e});_.extend(e,this.options||{}),this.uploader=new mediaTheque.Uploader(e),this.uploader.filesError.on("add",this.uploadError,this),this.uploader.filesQueue.on("add",this.addProgressView,this),this.uploader.filesQueue.on("reset",this.removeSelf,this)},uploadError:function(e){var i=this.options||{},t=new Backbone.Model({dismissible:!0,type:"notice-error"}),s=e.get("file"),a=e.get("data");e.get("feedback")?t.set({message:e.get("feedback")}):t.set({message:a.message}),_.isObject(i.mediaView)?(i.mediaView.collection.remove(s.id),i.mediaView.views.add(new mediaTheque.Views.Feedback({model:t}),{at:0})):this.views.add("#mediatheque-upload-status",new mediaTheque.Views.Feedback({model:t}))},addProgressView:function(e){var i=this.options||{};_.isObject(i.mediaView)?i.mediaView.collection.add(e.set({at:0},{silent:!0})):this.views.add("#mediatheque-upload-status",new mediaTheque.Views.uploaderProgress({model:e}))}}),mediaTheque.Views.ToolbarItem=mediaTheque.View.extend({tagName:"li",template:mediaTheque.template("mediatheque-toolbar-item"),initialize:function(){this.model.get("current")&&(this.el.className="current"),this.model.on("change:disable",this.refreshItem,this)},refreshItem:function(e,i){d(this.$el).find("button").first().prop("disabled",i)}}),mediaTheque.Views.Toolbar=mediaTheque.View.extend({tagName:"ul",className:"filter-links",events:{"click button":"activateView"},initialize:function(){var t=this.options||{},s=0,a=!1;_.each(mediaThequeSettings.toolbarItems,function(e,i){s+=1,a=!(!t.users.length||"users"!==i),this.collection.add({id:i,name:e,position:s,current:a,disable:0!==t.users.length&&"users"!==i}),this.addItemBar(this.collection.get(i))},this),this.collection.on("change:current",this.refreshToolbar,this)},addItemBar:function(e){this.views.add(new mediaTheque.Views.ToolbarItem({model:e}))},refreshToolbar:function(e,i){!1!==i&&"false"!==i&&(_.each(this.$el.children(),function(e){d(e).removeClass("current")}),d(this.$el).find('[data-id="'+e.get("id")+'"]').parent("li").addClass("current"))},activateView:function(e){e.preventDefault();var t=d(e.currentTarget),s=!1,a=null;t.prop("disabled")||("upload"===t.data("id")||"directory"===t.data("id")?a=t.data("id"):"users"===t.data("id")&&(s=!0),_.each(this.collection.models,function(e){var i={disable:s,current:!1,active:!1};_.isNull(a)?e.get("id")===t.data("id")&&(i.current=!0,"users"===e.get("id")&&(i.disable=!1)):e.get("id")===a?i.active=!0:i.current=e.get("current"),e.set(i)},this))}}),mediaTheque.Views.trailItem=mediaTheque.Views.Droppable.extend({tagName:"li",template:mediaTheque.template("mediatheque-trail"),initialize:function(){mediaTheque.Views.Droppable.prototype.initialize.apply(this,arguments),this.isDroppable=!1,this.model.get("showLink")&&this.model.unset("showLink",{silent:!0}),this.model.on("change:showLink",this.rerender,this),this.model.on("remove",this.remove,this)},rerender:function(e,i){!0===i&&(this.isDroppable=!0),this.render()}}),mediaTheque.Views.Trail=mediaTheque.View.extend({tagName:"ul",className:"trail-links",events:{"click a":"moveUp"},initialize:function(){this.collection.on("reset",this.resetTrail,this),this.collection.on("add",this.addTrailItem,this)},resetTrail:function(){!_.isUndefined(this.views._views[""])&&this.views._views[""].length&&_.each(this.views._views[""],function(e){e.remove()})},addTrailItem:function(e){this.views.add(new mediaTheque.Views.trailItem({model:e,ghost:this.options.ghost}))},moveUp:function(e){var i,t=this.options||{};e.preventDefault(),"root-dir"===(i=d(e.currentTarget).prop("class"))?t.queryVars.set({parent:0},{move:i}):"parent-dir"===i&&t.queryVars.set({parent:d(e.currentTarget).data("id")},{move:i})}}),mediaTheque.Views.Root=mediaTheque.View.extend({initialize:function(){var e=this.options||{};this.ghost=new Backbone.Collection,this.listenTo(e.toolbarItems,"change:active",this.displayForms),this.listenTo(e.toolbarItems,"change:current",this.manageLists),this.listenTo(e.queryVars,"change:parent",this.updateTrail),"wp-editor"===e.uiType?(e.users=[],this.setToolbar({models:e.users})):(this.views.set("#users",new mediaTheque.Views.Users({collection:e.users,ghost:this.ghost})),this.listenTo(e.users,"reset",this.queryUsers),e.users.on("change:current",this.setToolbar,this),e.users.reset())},queryUsers:function(){(this.options||{}).users.fetch({data:{has_disk_usage:!0},success:_.bind(this.setToolbar,this)})},displayToolbar:function(){var e=this.options||{};_.isUndefined(this.views._views["#toolbar"])&&this.views.add("#toolbar",new mediaTheque.Views.Toolbar({collection:e.toolbarItems,users:e.users}))},setToolbar:function(e,i){var t=this.options||{};_.isUndefined(e.models)||!e.models.length?!_.isUndefined(i)&&!1===i||(_.isUndefined(this.views._views["#toolbar"])?(delete mediaThequeSettings.toolbarItems.users,this.displayToolbar(),i=t.toolbarItems.findWhere({current:!0}),_.isUndefined(i)?_.first(t.toolbarItems.models).set({current:!0}):this.manageLists(i,!0),(i=t.toolbarItems.findWhere({active:!0}))&&t.toolbarItems.get(i).set({active:!1},{silent:!0})):_.each(t.toolbarItems.models,function(e,i){var t={disable:!1,current:!1};1===i&&(t.current=!0),e.set(t)})):this.displayToolbar()},displayForms:function(i,e){var t=this.options||{},s={post_status:"publish"},a=null,d=_.isUndefined(this.views._views["#forms"])||0===this.views._views["#forms"].length;-1!==_.indexOf(["upload","directory"],i.get("id"))&&(!1===e?d||_.each(this.views._views["#forms"],function(e){("upload"===i.get("id")&&e.uploader||"directory"===i.get("id")&&!e.uploader)&&e.remove()}):(d||_.each(this.views._views["#forms"],function(e){e.remove()}),a=t.toolbarItems.findWhere({current:!0}),_.isObject(a)&&(s.post_status=a.get("id")),t.queryVars.get("parent")&&(s.post_parent=t.queryVars.get("parent")),t.queryVars.get("user_id")&&(s.user_id=t.queryVars.get("user_id")),"upload"===i.get("id")?this.views.add("#forms",new mediaTheque.Views.Uploader({overrides:t.overrides,params:s,toolbarItem:"upload",mediaView:_.first(this.views._views["#media"])})):this.views.add("#forms",new mediaTheque.Views.MkDir({params:s,toolbarItem:"directory",model:new Backbone.Model(mediaThequeSettings.dirmaker),mediaView:_.first(this.views._views["#media"])}))))},manageLists:function(e,i){var t=this.options||{};"users"===e.get("id")?(_.isUndefined(this.views._views["#media"])||0===this.views._views["#media"].length||_.first(this.views._views["#media"]).remove(),!1!==i||_.isUndefined(this.views._views["#users"])||0===this.views._views["#users"].length||_.first(this.views._views["#users"]).remove(),!0===i&&(this.views.set("#users",new mediaTheque.Views.Users({collection:t.users,ghost:this.ghost})),t.users.reset(),_.isUndefined(this.views._views["#trail"])||0===this.views._views["#trail"].length||_.first(this.views._views["#trail"]).remove())):!0===i&&(!_.isUndefined(this.views._views["#trail"])&&0!==this.views._views["#trail"].length||this.views.add("#trail",new mediaTheque.Views.Trail({collection:t.trailItems,ghost:this.ghost,queryVars:t.queryVars})),t.trailItems.reset(),t.queryVars.clear(),t.queryVars.set({user_media_context:_.isUndefined(t.uiType)?"admin":t.uiType,post_status:e.get("id"),parent:0},{silent:!0}),t.users.length?(i=t.users.findWhere({current:!0}),t.queryVars.set({user_id:i.get("id")},{silent:!0}),t.trailItems.add(i)):t.queryVars.set({user_id:0},{silent:!0}),t.trailItems.add(e),this.views.set("#media",new mediaTheque.Views.UserMedias({collection:t.media,ghost:this.ghost,queryVars:t.queryVars,selection:t.selection})))},updateTrail:function(e,i,t){var s,a,d,r=this.options||{};_.isUndefined(i)||(d=this.ghost.get(i),_.isUndefined(d)||t.move?t.move&&("root-dir"===t.move?(s=r.toolbarItems.findWhere({current:!0}),r.trailItems.get(s.get("id")).set({showLink:!1})):r.trailItems.get(i).set({showLink:!1}),a=r.trailItems.where({media_type:"dir"}),_.each(a,function(e){("root-dir"===t.move||e.get("id")>i)&&r.trailItems.remove(e)})):(0===d.get("parent")?(s=r.toolbarItems.findWhere({current:!0}),r.trailItems.get(s.get("id")).set({showLink:!0})):r.trailItems.get(d.get("parent")).set({showLink:!0}),r.trailItems.add(this.ghost.get(i))))}}),mediaTheque.Views.Display=mediaTheque.View.extend({initialize:function(){var e=this.options||{};this.ghost=new Backbone.Collection,this.views.set("#media",new mediaTheque.Views.displayUserMedias({collection:e.media,ghost:this.ghost,queryVars:e.queryVars,scrollingElement:"#mediatheque-container"}))}}),mediaTheque.Views.Field=mediaTheque.View.extend({tagName:"label",template:mediaTheque.template("mediatheque-field-item"),initialize:function(){var e=this.model.get("classes");-1!==_.indexOf(["submit","reset"],this.model.get("type"))?this.el.className=this.model.get("type"):_.isArray(e)&&(this.el.className=e.join(" "))}})}(jQuery);